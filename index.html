<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Koko päivän ja pitkät tapahtumat</title>
  <script src="https://accounts.google.com/gsi/client" async defer></script>
  <script src="https://apis.google.com/js/api.js"></script>
</head>
<body>
  <h2>Koko päivän ja pitkät tapahtumat</h2>
  <div id="g_id_onload"
       data-client_id="369148508096-2i2l04iqj26c1sf3p68ktjlnptgel90t.apps.googleusercontent.com"
       data-callback="handleCredentialResponse"
       data-auto_prompt="false">
  </div>
  <div class="g_id_signin" data-type="standard"></div>

  <ul id="events"></ul>

  <script>
    const API_KEY = 'AIzaSyA8I155Js5gNoCQc3vwyF6PlViagRU4QNk';

    function handleCredentialResponse(response) {
      // Alustetaan GAPI ja käytetään saatua tunnistetta
      gapi.load('client', async () => {
        await gapi.client.init({
          apiKey: API_KEY,
          discoveryDocs: ["https://www.googleapis.com/discovery/v1/apis/calendar/v3/rest"],
        });

        // Asetetaan OAuth-tokeniksi GIS:n palauttama id_token
        gapi.client.setToken({access_token: response.credential});

        listUpcomingEvents();
      });
    }

    function listUpcomingEvents() {
      const timeNow = (new Date()).toISOString();
      gapi.client.calendar.events.list({
        calendarId: 'primary',
        timeMin: timeNow,
        showDeleted: false,
        singleEvents: true,
        maxResults: 50,
        orderBy: 'startTime'
      }).then(response => {
        const events = response.result.items;
        const list = document.getElementById('events');
        list.innerHTML = '';

        if (events.length > 0) {
          events.forEach(event => {
            const start = event.start.dateTime || event.start.date;
            const end = event.end.dateTime || event.end.date;

            const isAllDay = !!event.start.date;
            const isMultiDay = new Date(end) - new Date(start) > 24 * 60 * 60 * 1000;

            if (isAllDay || isMultiDay) {
              const li = document.createElement('li');
              li.textContent = `${event.summary} (${start} - ${end})`;
              list.appendChild(li);
            }
          });
        } else {
          list.innerHTML = '<li>Ei tulevia koko päivän tapahtumia.</li>';
        }
      });
    }
  </script>
</body>
</html
