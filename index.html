<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Koko päivän ja pitkät tapahtumat</title>
  <script src="https://apis.google.com/js/api.js"></script>
</head>
<body>
  <h2>Koko päivän ja pitkät tapahtumat</h2>
  <button onclick="handleAuthClick()">Kirjaudu Googleen</button>
  <ul id="events"></ul>

  <script>
    const CLIENT_ID = '369148508096-2i2l04iqj26c1sf3p68ktjlnptgel90t.apps.googleusercontent.com';
    const API_KEY = 'AIzaSyA8I155Js5gNoCQc3vwyF6PlViagRU4QNk';

    const DISCOVERY_DOCS = ["https://www.googleapis.com/discovery/v1/apis/calendar/v3/rest"];
    const SCOPES = "https://www.googleapis.com/auth/calendar.readonly";

    function handleClientLoad() {
      gapi.load('client:auth2', initClient);
    }

    function initClient() {
      gapi.client.init({
        apiKey: API_KEY,
        clientId: CLIENT_ID,
        discoveryDocs: DISCOVERY_DOCS,
        scope: SCOPES
      }).then(() => {
        // Kirjautuminen vasta painettaessa nappia
      });
    }

    function handleAuthClick() {
      gapi.auth2.getAuthInstance().signIn().then(listUpcomingEvents);
    }

    function listUpcomingEvents() {
      gapi.client.calendar.events.list({
        calendarId: 'primary',
        timeMin: (new Date()).toISOString(),
        showDeleted: false,
        singleEvents: true,
        maxResults: 50,
        orderBy: 'startTime'
      }).then(response => {
        const events = response.result.items;
        const list = document.getElementById('events');
        list.innerHTML = '';

        if (events.length > 0) {
          events.forEach(event => {
            const start = event.start.dateTime || event.start.date;
            const end = event.end.dateTime || event.end.date;

            // Näytetään vain koko päivän tai yli päivän kestäviä tapahtumia
            const isAllDay = !!event.start.date;
            const isMultiDay = new Date(end) - new Date(start) > 24 * 60 * 60 * 1000;

            if (isAllDay || isMultiDay) {
              const li = document.createElement('li');
              li.textContent = `${event.summary} (${start} - ${end})`;
              list.appendChild(li);
            }
          });
        } else {
          list.innerHTML = '<li>Ei tulevia koko päivän tapahtumia.</li>';
        }
      });
    }

    handleClientLoad();
  </script>
</body>
</html>
